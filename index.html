<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>S15 åŸç”» + ç‚«ç¥è§£è¯´</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;background:#000;color:#eee;height:100vh;display:flex;flex-direction:column;overflow:hidden}
  
  header{background:#18181b;padding:10px 15px;font-size:14px;display:flex;align-items:center;gap:10px;z-index:10}
  .live{background:#ff4655;color:#fff;padding:2px 8px;border-radius:4px;font-weight:700;font-size:12px}
  
  .status{
    display:flex;
    align-items:center;
    gap:6px;
    margin-left:auto;
    font-size:12px;
    padding:4px 10px;
    border-radius:4px;
    background:rgba(255,255,255,.1);
  }
  .dot{
    width:8px;
    height:8px;
    border-radius:50%;
    background:#666;
    animation:pulse 1.5s ease-in-out infinite;
  }
  .dot.loading{background:#ffa500}
  .dot.success{background:#0f0;animation:none}
  .dot.error{background:#f00;animation:blink 1s infinite}
  
  @keyframes pulse{
    0%,100%{opacity:.4}
    50%{opacity:1}
  }
  @keyframes blink{
    0%,100%{opacity:1}
    50%{opacity:.3}
  }
  
  .box{flex:1;display:flex;gap:0;padding:0;position:relative}
  iframe{width:100%;height:100%;border:0}
  
  /* ========== ğŸ†• æ™ºèƒ½æŠ˜å éŸ³é¢‘æ’­æ”¾å™¨ ========== */
  .audio-widget{
    position:fixed;
    bottom:15px;
    right:15px;
    background:rgba(0,0,0,.95);
    border-radius:10px;
    box-shadow:0 8px 24px rgba(0,0,0,.8), 0 0 0 1px rgba(102,126,234,.3);
    overflow:hidden;
    z-index:1000;
    user-select:none;
    backdrop-filter:blur(10px);
    transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* æŠ˜å çŠ¶æ€ï¼šåªæ˜¾ç¤ºæ ‡é¢˜æ  */
  .audio-widget.collapsed{
    width:200px !important;
    height:40px !important;
  }
  
  /* å±•å¼€çŠ¶æ€ï¼šæ˜¾ç¤ºå®Œæ•´æ’­æ”¾å™¨ */
  .audio-widget.expanded{
    width:320px !important;
    height:220px !important;
  }
  
  /* æ ‡é¢˜æ ï¼šå¯æ‹–åŠ¨åŒºåŸŸ */
  .audio-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:10px 12px;
    background:linear-gradient(135deg, rgba(102,126,234,.2) 0%, rgba(118,75,162,.2) 100%);
    border-bottom:1px solid rgba(255,255,255,.1);
    cursor:move;
    min-height:40px;
  }
  
  .audio-header:hover{
    background:linear-gradient(135deg, rgba(102,126,234,.3) 0%, rgba(118,75,162,.3) 100%);
  }
  
  .audio-title{
    display:flex;
    align-items:center;
    gap:8px;
    font-size:13px;
    font-weight:600;
    flex:1;
  }
  
  .audio-icon{
    font-size:16px;
    animation:pulse-icon 2s infinite;
  }
  
  @keyframes pulse-icon{
    0%,100%{transform:scale(1)}
    50%{transform:scale(1.1)}
  }
  
  /* æŠ˜å /å±•å¼€æŒ‰é’® */
  .audio-toggle{
    cursor:pointer;
    padding:4px 8px;
    border-radius:4px;
    transition:all .2s;
    font-size:14px;
    line-height:1;
    background:rgba(255,255,255,.1);
  }
  
  .audio-toggle:hover{
    background:rgba(255,255,255,.2);
    transform:scale(1.1);
  }
  
  .audio-widget.collapsed .audio-toggle{
    transform:rotate(180deg);
  }
  
  .audio-widget.collapsed .audio-toggle:hover{
    transform:rotate(180deg) scale(1.1);
  }
  
  /* æ’­æ”¾å™¨å®¹å™¨ */
  .audio-player{
    width:100%;
    height:180px;
    opacity:1;
    transition:all .3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow:hidden;
  }
  
  .audio-widget.collapsed .audio-player{
    height:0;
    opacity:0;
    pointer-events:none;
  }
  
  /* æ‹–åŠ¨æ—¶çš„è§†è§‰åé¦ˆ */
  .audio-widget.dragging{
    opacity:.9;
    box-shadow:0 12px 40px rgba(102,126,234,.5);
    cursor:move;
  }
  
  /* ğŸ†• é¦–æ¬¡ä½¿ç”¨æç¤ºæ°”æ³¡ */
  .hint-bubble{
    position:absolute;
    top:-50px;
    left:50%;
    transform:translateX(-50%);
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    color:#fff;
    padding:8px 15px;
    border-radius:20px;
    font-size:12px;
    white-space:nowrap;
    box-shadow:0 4px 12px rgba(102,126,234,.4);
    animation:float 2s ease-in-out infinite;
    opacity:0;
    pointer-events:none;
    transition:opacity .3s;
  }
  
  .hint-bubble.show{
    opacity:1;
  }
  
  .hint-bubble::after{
    content:'';
    position:absolute;
    bottom:-6px;
    left:50%;
    transform:translateX(-50%);
    width:0;
    height:0;
    border-left:6px solid transparent;
    border-right:6px solid transparent;
    border-top:6px solid #764ba2;
  }
  
  @keyframes float{
    0%,100%{transform:translateX(-50%) translateY(0)}
    50%{transform:translateX(-50%) translateY(-5px)}
  }
  
  /* å¯åŠ¨æŒ‰é’®é®ç½©å±‚ */
  .overlay{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,.95);
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:9999;
    transition:opacity .5s;
  }
  .overlay.hidden{
    opacity:0;
    pointer-events:none;
  }
  .start-btn{
    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    color:#fff;
    border:none;
    padding:15px 40px;
    font-size:18px;
    font-weight:700;
    border-radius:50px;
    cursor:pointer;
    box-shadow:0 8px 20px rgba(102,126,234,.3);
    transition:all .3s;
  }
  .start-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 30px rgba(102,126,234,.5);
  }
  .start-btn:active{
    transform:translateY(0);
  }
  .hint{
    margin-top:20px;
    font-size:13px;
    color:#999;
    text-align:center;
    max-width:400px;
  }
  .hint.warning{
    color:#ff4655;
    font-weight:600;
    margin-top:10px;
  }

  /* è°ƒè¯•æ—¥å¿— */
  .debug{
    position:fixed;
    top:60px;
    right:15px;
    background:rgba(0,0,0,.9);
    border:1px solid #333;
    border-radius:6px;
    padding:10px;
    font-size:11px;
    font-family:monospace;
    max-width:350px;
    max-height:200px;
    overflow-y:auto;
    color:#0f0;
    display:none;
    z-index:999;
  }
  .debug.show{display:block}
  .debug div{margin:2px 0}
  
  /* ğŸ†• å“åº”å¼é€‚é… */
  @media (max-width: 768px) {
    .audio-widget.expanded{
      width:280px !important;
      height:200px !important;
    }
    .audio-player{
      height:160px;
    }
  }
</style>
</head>
<body>

<!-- å¯åŠ¨é®ç½©å±‚ -->
<div class="overlay" id="overlay">
  <button class="start-btn" id="startBtn">ğŸ¬ ç‚¹å‡»å¼€å§‹è§‚çœ‹</button>
  <div class="hint">éœ€è¦ç”¨æˆ·äº¤äº’æ‰èƒ½æ’­æ”¾éŸ³é¢‘</div>
  <div class="hint warning" id="protocolWarning" style="display:none">
    âš ï¸ æ£€æµ‹åˆ° file:// åè®®ï¼è¯·ä½¿ç”¨ HTTP æœåŠ¡å™¨è®¿é—®
  </div>
</div>

<header>
  <span class="live">LIVE</span>
  <span>S15 å®˜æ–¹ç”»é¢ + Lastç‚«ç¥è§£è¯´</span>
  
  <div class="status">
    <span class="dot loading" id="statusDot"></span>
    <span id="statusText">ç­‰å¾…å¯åŠ¨...</span>
  </div>
</header>

<section class="box">
  <!-- å®˜æ–¹ç”»é¢ï¼ˆå…¨å±ï¼‰ -->
  <iframe id="video"
          sandbox="allow-scripts allow-same-origin allow-presentation"
          allow="autoplay *; encrypted-media *; fullscreen *"
          referrerpolicy="no-referrer">
  </iframe>
</section>

<!-- ========== ğŸ†• æ™ºèƒ½æŠ˜å éŸ³é¢‘æ’­æ”¾å™¨ ========== -->
<div class="audio-widget collapsed" id="audioWidget">
  <!-- æç¤ºæ°”æ³¡ -->
  <div class="hint-bubble" id="hintBubble">ğŸ‘† ç‚¹å‡»å±•å¼€æ’­æ”¾å™¨</div>
  
  <!-- æ ‡é¢˜æ ï¼ˆå¯æ‹–åŠ¨ï¼‰ -->
  <div class="audio-header" id="audioHeader">
    <div class="audio-title">
      <span class="audio-icon">ğŸ™ï¸</span>
      <span>ç‚«ç¥è§£è¯´</span>
    </div>
    <span class="audio-toggle" id="audioToggle">â–²</span>
  </div>
  
  <!-- æ’­æ”¾å™¨åŒºåŸŸï¼ˆå¯æŠ˜å ï¼‰ -->
  <div class="audio-player">
    <iframe id="audio"
            sandbox="allow-scripts allow-same-origin allow-presentation"
            allow="autoplay *; encrypted-media *"
            referrerpolicy="no-referrer"
            style="width:100%;height:100%;border:0">
    </iframe>
  </div>
</div>

<!-- è°ƒè¯•æ—¥å¿— -->
<div class="debug" id="debug"></div>

<script>
// ========== è°ƒè¯•æ—¥å¿—ç³»ç»Ÿ ==========
const debugPanel = document.getElementById('debug');
let debugEnabled = false; // ğŸ†• é»˜è®¤å…³é—­ï¼Œéœ€è¦æ—¶æ”¹ä¸º true

function log(msg) {
  const now = new Date().toLocaleTimeString();
  console.log(`[${now}] ${msg}`);
  
  if (debugEnabled) {
    debugPanel.classList.add('show');
    const div = document.createElement('div');
    div.textContent = `${now} ${msg}`;
    debugPanel.appendChild(div);
    debugPanel.scrollTop = debugPanel.scrollHeight;
  }
}

// ========== æ£€æµ‹åè®® ==========
const protocol = window.location.protocol;
log(`å½“å‰åè®®: ${protocol}`);

if (protocol === 'file:') {
  document.getElementById('protocolWarning').style.display = 'block';
  log('âš ï¸ è­¦å‘Šï¼šæ­£åœ¨ä½¿ç”¨ file:// åè®®');
}

// ========== ç”¨æˆ·äº¤äº’å¯åŠ¨ ==========
const overlay = document.getElementById('overlay');
const startBtn = document.getElementById('startBtn');
const videoFrame = document.getElementById('video');
const audioFrame = document.getElementById('audio');
const statusDot = document.getElementById('statusDot');
const statusText = document.getElementById('statusText');

startBtn.onclick = () => {
  log('ç”¨æˆ·ç‚¹å‡»å¯åŠ¨æŒ‰é’®');
  
  videoFrame.src = 'https://www.bilibili.com/blackboard/live/live-activity-player.html?cid=7734200&quality=1';
  audioFrame.src = 'https://www.bilibili.com/blackboard/live/live-activity-player.html?cid=84074&quality=1';
  
  overlay.classList.add('hidden');
  
  statusDot.className = 'dot loading';
  statusText.textContent = 'æ­£åœ¨è¿æ¥...';
  log('å¼€å§‹åŠ è½½ç›´æ’­æµ');
};

// ========== iframe åŠ è½½ç›‘æ§ ==========
let videoLoaded = false;
let audioLoaded = false;

videoFrame.onload = () => {
  videoLoaded = true;
  log('âœ“ å®˜æ–¹ç”»é¢åŠ è½½å®Œæˆ');
  checkBothLoaded();
};

audioFrame.onload = () => {
  audioLoaded = true;
  log('âœ“ è§£è¯´éŸ³é¢‘åŠ è½½å®Œæˆ');
  checkBothLoaded();
};

audioFrame.onerror = () => {
  log('âœ— éŸ³é¢‘åŠ è½½å¤±è´¥');
  statusDot.className = 'dot error';
  statusText.textContent = 'éŸ³é¢‘åŠ è½½å¤±è´¥';
};

function checkBothLoaded() {
  if (videoLoaded && audioLoaded) {
    log('ä¸¤ä¸ª iframe éƒ½å·²åŠ è½½');
    
    setTimeout(() => {
      statusDot.className = 'dot success';
      statusText.textContent = 'å·²è¿æ¥';
      log('âœ… æ’­æ”¾å™¨å·²åˆå§‹åŒ–');
      
      // ğŸ†• æ˜¾ç¤ºæç¤ºæ°”æ³¡
      showHintBubble();
    }, 2000);
  }
}

// ========== ğŸ†• æ™ºèƒ½æŠ˜å åŠŸèƒ½ ========== 
const audioWidget = document.getElementById('audioWidget');
const audioToggle = document.getElementById('audioToggle');
const hintBubble = document.getElementById('hintBubble');

// LocalStorage é”®å
const STORAGE_KEY_COLLAPSED = 'audioWidget_collapsed';
const STORAGE_KEY_POSITION = 'audioWidget_position';

// æ¢å¤ä¸Šæ¬¡çš„æŠ˜å çŠ¶æ€
function restoreState() {
  const savedCollapsed = localStorage.getItem(STORAGE_KEY_COLLAPSED);
  const savedPosition = localStorage.getItem(STORAGE_KEY_POSITION);
  
  // æ¢å¤æŠ˜å çŠ¶æ€
  if (savedCollapsed === 'false') {
    audioWidget.classList.remove('collapsed');
    audioWidget.classList.add('expanded');
    log('æ¢å¤å±•å¼€çŠ¶æ€');
  } else {
    // é»˜è®¤æŠ˜å 
    audioWidget.classList.add('collapsed');
    audioWidget.classList.remove('expanded');
    log('é»˜è®¤æŠ˜å çŠ¶æ€');
  }
  
  // æ¢å¤ä½ç½®
  if (savedPosition) {
    try {
      const pos = JSON.parse(savedPosition);
      audioWidget.style.left = pos.left;
      audioWidget.style.top = pos.top;
      audioWidget.style.right = 'auto';
      audioWidget.style.bottom = 'auto';
      log(`æ¢å¤ä½ç½®: ${pos.left}, ${pos.top}`);
    } catch (e) {
      log('ä½ç½®æ¢å¤å¤±è´¥');
    }
  }
}

// åˆ‡æ¢æŠ˜å /å±•å¼€
audioToggle.onclick = (e) => {
  e.stopPropagation();
  const isCollapsed = audioWidget.classList.contains('collapsed');
  
  if (isCollapsed) {
    // å±•å¼€
    audioWidget.classList.remove('collapsed');
    audioWidget.classList.add('expanded');
    localStorage.setItem(STORAGE_KEY_COLLAPSED, 'false');
    log('å±•å¼€æ’­æ”¾å™¨');
  } else {
    // æŠ˜å 
    audioWidget.classList.remove('expanded');
    audioWidget.classList.add('collapsed');
    localStorage.setItem(STORAGE_KEY_COLLAPSED, 'true');
    log('æŠ˜å æ’­æ”¾å™¨');
  }
  
  // éšè—æç¤ºæ°”æ³¡
  hintBubble.classList.remove('show');
};

// ğŸ†• æ˜¾ç¤ºæç¤ºæ°”æ³¡ï¼ˆé¦–æ¬¡ä½¿ç”¨æˆ–åŠ è½½å®Œæˆåï¼‰
function showHintBubble() {
  const isCollapsed = audioWidget.classList.contains('collapsed');
  if (isCollapsed) {
    hintBubble.classList.add('show');
    
    // 5ç§’åè‡ªåŠ¨éšè—
    setTimeout(() => {
      hintBubble.classList.remove('show');
    }, 5000);
    
    log('æ˜¾ç¤ºæ“ä½œæç¤º');
  }
}

// ========== ğŸ†• æ‹–åŠ¨åŠŸèƒ½ ==========
const audioHeader = document.getElementById('audioHeader');
let isDragging = false;
let startX = 0;
let startY = 0;
let offsetX = 0;
let offsetY = 0;
let hasMoved = false; // ğŸ†• åŒºåˆ†ç‚¹å‡»å’Œæ‹–åŠ¨

// é¼ æ ‡æŒ‰ä¸‹
audioHeader.onmousedown = (e) => {
  // å¦‚æœç‚¹å‡»çš„æ˜¯åˆ‡æ¢æŒ‰é’®ï¼Œä¸è§¦å‘æ‹–åŠ¨
  if (e.target.closest('#audioToggle')) return;
  
  isDragging = true;
  hasMoved = false;
  audioWidget.classList.add('dragging');
  
  startX = e.clientX;
  startY = e.clientY;
  
  const rect = audioWidget.getBoundingClientRect();
  offsetX = rect.left;
  offsetY = rect.top;
  
  e.preventDefault();
  log('å¼€å§‹æ‹–åŠ¨');
};

// é¼ æ ‡ç§»åŠ¨
document.onmousemove = (e) => {
  if (!isDragging) return;
  
  const deltaX = e.clientX - startX;
  const deltaY = e.clientY - startY;
  
  // ç§»åŠ¨è¶…è¿‡5pxæ‰ç®—çœŸæ­£æ‹–åŠ¨ï¼ˆé¿å…è¯¯è§¦ï¼‰
  if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
    hasMoved = true;
  }
  
  let newLeft = offsetX + deltaX;
  let newTop = offsetY + deltaY;
  
  // è¾¹ç•Œé™åˆ¶
  const maxX = window.innerWidth - audioWidget.offsetWidth;
  const maxY = window.innerHeight - audioWidget.offsetHeight;
  
  newLeft = Math.max(0, Math.min(newLeft, maxX));
  newTop = Math.max(0, Math.min(newTop, maxY));
  
  audioWidget.style.left = newLeft + 'px';
  audioWidget.style.top = newTop + 'px';
  audioWidget.style.right = 'auto';
  audioWidget.style.bottom = 'auto';
};

// é¼ æ ‡æ¾å¼€
document.onmouseup = () => {
  if (isDragging) {
    isDragging = false;
    audioWidget.classList.remove('dragging');
    
    if (hasMoved) {
      // ä¿å­˜ä½ç½®
      const position = {
        left: audioWidget.style.left,
        top: audioWidget.style.top
      };
      localStorage.setItem(STORAGE_KEY_POSITION, JSON.stringify(position));
      log(`ä¿å­˜ä½ç½®: ${position.left}, ${position.top}`);
    }
  }
};

// ========== ğŸ†• è§¦æ‘¸è®¾å¤‡æ”¯æŒ ==========
audioHeader.ontouchstart = (e) => {
  if (e.target.closest('#audioToggle')) return;
  
  const touch = e.touches[0];
  isDragging = true;
  hasMoved = false;
  
  startX = touch.clientX;
  startY = touch.clientY;
  
  const rect = audioWidget.getBoundingClientRect();
  offsetX = rect.left;
  offsetY = rect.top;
  
  e.preventDefault();
};

document.ontouchmove = (e) => {
  if (!isDragging) return;
  
  const touch = e.touches[0];
  const deltaX = touch.clientX - startX;
  const deltaY = touch.clientY - startY;
  
  if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {
    hasMoved = true;
  }
  
  let newLeft = offsetX + deltaX;
  let newTop = offsetY + deltaY;
  
  const maxX = window.innerWidth - audioWidget.offsetWidth;
  const maxY = window.innerHeight - audioWidget.offsetHeight;
  
  newLeft = Math.max(0, Math.min(newLeft, maxX));
  newTop = Math.max(0, Math.min(newTop, maxY));
  
  audioWidget.style.left = newLeft + 'px';
  audioWidget.style.top = newTop + 'px';
  audioWidget.style.right = 'auto';
  audioWidget.style.bottom = 'auto';
};

document.ontouchend = () => {
  if (isDragging) {
    isDragging = false;
    
    if (hasMoved) {
      const position = {
        left: audioWidget.style.left,
        top: audioWidget.style.top
      };
      localStorage.setItem(STORAGE_KEY_POSITION, JSON.stringify(position));
    }
  }
};

// ========== ğŸ†• çª—å£å¤§å°è°ƒæ•´æ—¶çš„è¾¹ç•Œæ£€æŸ¥ ==========
window.addEventListener('resize', () => {
  const rect = audioWidget.getBoundingClientRect();
  
  // å¦‚æœè¶…å‡ºå±å¹•ï¼Œé‡æ–°å®šä½
  if (rect.right > window.innerWidth || rect.bottom > window.innerHeight) {
    audioWidget.style.left = 'auto';
    audioWidget.style.top = 'auto';
    audioWidget.style.right = '15px';
    audioWidget.style.bottom = '15px';
    
    // æ¸…é™¤ä¿å­˜çš„ä½ç½®
    localStorage.removeItem(STORAGE_KEY_POSITION);
    log('çª—å£è°ƒæ•´ï¼Œé‡ç½®ä½ç½®');
  }
});

// ========== ğŸ†• é”®ç›˜å¿«æ·é”® ==========
document.addEventListener('keydown', (e) => {
  // æŒ‰ Space é”®åˆ‡æ¢æŠ˜å /å±•å¼€ï¼ˆéœ€è¦ Ctrl æˆ– Cmd ä¿®é¥°é”®ï¼Œé¿å…è¯¯è§¦ï¼‰
  if ((e.ctrlKey || e.metaKey) && e.code === 'Space') {
    e.preventDefault();
    audioToggle.click();
    log('å¿«æ·é”®åˆ‡æ¢æŠ˜å çŠ¶æ€');
  }
  
  // æŒ‰ ESC é”®å¿«é€ŸæŠ˜å 
  if (e.code === 'Escape' && !audioWidget.classList.contains('collapsed')) {
    e.preventDefault();
    audioToggle.click();
    log('ESC å¿«é€ŸæŠ˜å ');
  }
});

// ========== ğŸ†• ç›‘å¬ç”¨æˆ·ç‚¹å‡»æ’­æ”¾å™¨ï¼ˆæ£€æµ‹äº¤äº’ï¼‰ ==========
let userInteracted = false;

document.addEventListener('click', (e) => {
  if (!userInteracted && e.target.closest('.audio-player')) {
    userInteracted = true;
    log('âœ“ ç”¨æˆ·å·²ç‚¹å‡»æ’­æ”¾å™¨');
    
    // æ›´æ–°çŠ¶æ€æç¤º
    setTimeout(() => {
      statusText.textContent = 'æ’­æ”¾ä¸­';
    }, 500);
  }
}, true);

// ========== è¶…æ—¶æ£€æµ‹ ==========
let loadTimer;
startBtn.addEventListener('click', () => {
  loadTimer = setTimeout(() => {
    if (!audioLoaded) {
      log('âœ— éŸ³é¢‘åŠ è½½è¶…æ—¶');
      statusDot.className = 'dot error';
      statusText.textContent = 'è¿æ¥è¶…æ—¶';
    }
  }, 10000);
});

audioFrame.addEventListener('load', () => {
  if (loadTimer) {
    clearTimeout(loadTimer);
  }
});

// ========== ğŸ†• å³é”®èœå•ï¼ˆå¿«æ·æ“ä½œï¼‰ ==========
audioWidget.addEventListener('contextmenu', (e) => {
  e.preventDefault();
  
  // å³é”®ç‚¹å‡»ï¼šé‡ç½®ä½ç½®
  audioWidget.style.left = 'auto';
  audioWidget.style.top = 'auto';
  audioWidget.style.right = '15px';
  audioWidget.style.bottom = '15px';
  
  localStorage.removeItem(STORAGE_KEY_POSITION);
  
  log('å³é”®é‡ç½®ä½ç½®');
  
  // çŸ­æš‚æ˜¾ç¤ºæç¤º
  const originalText = hintBubble.textContent;
  hintBubble.textContent = 'âœ“ ä½ç½®å·²é‡ç½®';
  hintBubble.classList.add('show');
  
  setTimeout(() => {
    hintBubble.textContent = originalText;
    hintBubble.classList.remove('show');
  }, 2000);
});

// ========== é¡µé¢åŠ è½½å®Œæˆ ==========
window.addEventListener('load', () => {
  // æ¢å¤ä¸Šæ¬¡çš„çŠ¶æ€
  restoreState();
  
  log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
  log('ç­‰å¾…ç”¨æˆ·ç‚¹å‡»å¯åŠ¨æŒ‰é’®...');
  
  // æ£€æµ‹æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾ç­–ç•¥
  if (navigator.permissions) {
    navigator.permissions.query({name: 'autoplay'}).then(result => {
      log(`è‡ªåŠ¨æ’­æ”¾æƒé™: ${result.state}`);
    }).catch(() => {
      log('æ— æ³•æŸ¥è¯¢è‡ªåŠ¨æ’­æ”¾æƒé™');
    });
  }
});

// ========== ğŸ†• é¡µé¢å¯è§æ€§æ£€æµ‹ ==========
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    log('âš ï¸ é¡µé¢åˆ‡æ¢åˆ°åå°');
  } else {
    log('âœ“ é¡µé¢åˆ‡æ¢åˆ°å‰å°');
  }
});

// ========== ğŸ†• è°ƒè¯•æ¨¡å¼åˆ‡æ¢ï¼ˆæŒ‰ Ctrl+Shift+Dï¼‰ ==========
let debugKeyCombo = [];
document.addEventListener('keydown', (e) => {
  debugKeyCombo.push(e.key);
  if (debugKeyCombo.length > 3) debugKeyCombo.shift();
  
  // Ctrl+Shift+D åˆ‡æ¢è°ƒè¯•æ¨¡å¼
  if (e.ctrlKey && e.shiftKey && e.key === 'D') {
    debugEnabled = !debugEnabled;
    debugPanel.classList.toggle('show', debugEnabled);
    log(`è°ƒè¯•æ¨¡å¼: ${debugEnabled ? 'å¼€å¯' : 'å…³é—­'}`);
  }
});

log('ğŸ® å¿«æ·é”®æç¤º:');
log('  â€¢ Ctrl/Cmd + Space: åˆ‡æ¢æŠ˜å /å±•å¼€');
log('  â€¢ ESC: å¿«é€ŸæŠ˜å ');
log('  â€¢ å³é”®æ’­æ”¾å™¨: é‡ç½®ä½ç½®');
log('  â€¢ Ctrl+Shift+D: å¼€å¯/å…³é—­è°ƒè¯•æ—¥å¿—');
</script>
</body>
</html>
